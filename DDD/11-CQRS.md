# DDD(DDD START!)

## 11월 28일

### 11.CQRS
#### 단일 모델의 단점
- 여러 애그리거트에서 데이터를 가져와야 할 때
- 한 번의 Select 쿼리로 조회 화면에 필요한 데이터를 읽어올 수 없어 조회 속도에 문제가 생길 수 있다.
- 경우에 따라 DBMS가 제공하는 전용 기능을 이용해서 조회 쿼리를 작성해야 해서 JPA의 네이티브 쿼리를 사용해야 할 수도 있다.
- 시스템의 사애트를 변경할 때와 조회할 때 단일 도메인 모델을 사용하기 때문이다.
- 객체 지향으로 도메인 모델을 구현할 때 
    - 도메인의 상태 변경을 구현하는 데는 적합
    - 주문 상세 조회 화면처럼 여러 애그리거트에서 데이터를 가져와 출력하는 기능을 구현하기에는 고려할 것들이 많아서 복잡성이 올라간다.

#### CQRS
- 상태를 변경하는 명령을 위한 모델과 상태를 제공하는 조회를 위한 모델을 분리하는 패턴
- 시스템이 제공하는 기능은 크게 두가지로 나누어 생각
    - 상태를 변경하는 기능
    - 상태 정보를 조회하는 기능
- 도메인 모델 관점에서 상태 변경 기능은 주로 한 애그리거트의 상태를 변경
- 도메인이 복잡할수록 명령 기능과 조회 기능이 다루는 데이터 범위에 차이가 발생하는데, 이 두 기능을 단일 모델로 처리하게 되면 조회 기능의 로딩 속도를 위해 모델 구현이 필요 이상으로 복잡해지는 문제가 발생
- CQRS를 사용하면 각 모델에 맞는 구현 기술을 선택할 수 있다.
- 단순히 데이터를 읽어와 조회하는 기능은 응용서비스 없이 구현할 수도 있다.
- 명령 모델
    - 상태를 변경하는 도메인 로직을 수행하는 데 초점을 맞춰 설계
- 조회 모델
    - 화면에 보여줄 데이터를 조회하는 데 초점을 맞춰 설계

#### 웹과 CQRS
- 포털이나 대형 온라인 쇼핑몰과 같이 조회 기능 요청 비율이 월등히 높은 서비스를 만드는 개발팀은 조회 성능을 높이기 위해 다양한 기법을 사용한다.
- 기본적으로 쿼리 최적화를 해서 쿼리 실행 속도 자체를 높이고, 메모리에 조회 데이터를 캐시해서 응답 속도를 높이기도 한다.
- 조회 전용 저장소를 따로 사용하기도 한다.
- 대규모 트래픽이 발생하는 웹 서비스는 알게 모르게 CQRS를 적용하게 된다.

#### CQRS 장단점
- 장점
    - 명령 모델을 구현할 때 도메인 자체에 집중할 수 있다
        - 명령 모델에서 조회 관련 로직이 사라져 복잡도를 낮춘다.
    - 조회 성능을 향상시키는 데 유리하다
        - 캐시, 조회 전용 저장소를 사용
- 단점
    - 구현해야 할 코드가 더 많다.
        - 구현 비용을 따져 봐야 한다.
    - 더 많은 구현 기술이 필요하다
        - 다른 구현기술을 사용해서 구현하기도 하고 경우에 따라 다른 저장소를 사용하기도 한다.
