# DDD(DDD START!)

## 5월 8일

### 2.아키텍처 개요

#### 네 개의 영역
- 표현 : 사용자의 요청을 받아 응용 영역에 전달
- 응용 : 처리 결과를 다시 사용자에게 보여주는 역할, 시스템이 사용자에게 제공해야 할 기능을 구현한다.
- 도메인 : 도메인 모델을 구현
- 인프라스트럭처 : 구현 기술에 대한 것을 다룬다. RDBMS 연동, 메시지큐 등

#### 계층 구조 아키텍처
- 표현 영역과 응용 영역은 도메인 영역을 사용하고, 도메인 영역은 인프라스트럭처 영역을 사용하므로 계층 구조를 적용하기에 적당해 보인다.
- 계층 구조는 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다.
- 구현의 편리함을 위해 계층 구조를 유연하게 적용 할 수 도 있다.
- 도메인의 복잡도에 따라 응용과 도메인을 분리하기도 하고 한 계층으로 합치기도 한다.

#### DIP
- 의존 역전 원칙
- 추상화한 인터페이스
- 고수준 모듈은 저수준 모듈을 의존해서 안된다.
- 저수준 모듈이 고수준 모듈을 의존하게 만들어야 한다.
- 독립적인 테스트를 쉽게 작성 할 수 있다.

#### 도메인 영역의 주요 구성요소
- 엔티티
    - 도메인의 모델의 데이터를 포함하여 해당 데이터와 관련된 기능을 함께 제공한다.
- 밸류
    - 고유의 식별자를 갖지 않는 주로 개념적으로 하나인 도메인 객체의 속성을 표현할 때 사용된다.
- 애그리거트
    - 애그리거트는 관련된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다.
- 리포지터리
    - 도메인 모델의 영속성을 처리한다.
- 도메인 서비스
    - 특정 엔티티에 속하지 않은 도메인 로직을 제공한다.

#### 엔티티와 밸류
- 도메인 모델의 엔티티와 DB 모델의 엔티티를 같은 것으로 생각하면 안된다.
- 실제 도메인 모델의 엔티티와 DB 관계형 모델의 엔티티는 같은 것이 아니다.
- 두 모델의 가장 큰 차이점은 도메인 모델의 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다는 점이다.
    - ex) 주문을 표현하는 엔티티는 주문과 관련된 데이터뿐만 아니라 배송지 주소 변경을 위한 기능을 함께 제공한다.
- 도메인 모델의 엔티티는 두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현 할 수 있다.

#### 애그리거트
- 도메인이 커질수록 도메인 모델도 커지면서 많은 엔티티와 밸류가 출현한다.
- 엔티티와 밸류 개수가 많아지면 많아질수록 모델은 점점 더 복잡해진다.
- 개별 객체뿐만 아니라 상위 수준에서 모델을 볼 수 있어야 전체 모델의 관계와 개별 모델을 이해하는 데 도움이 된다.
- 도메인 모델에서 전체 구조를 이해하는 데 도움이 되는 것이 바로 애그리거트이다.
- 애그리거트는 관련 객체를 하나로 묶은 군집이다.
- ex) 주문이라는 도메인개념에는 주문, 배송지정보, 주문자, 주문목록, 총결제 금액이라는 하위 도메인 모델이 있다. 이러한 하위 개념을 표현한 모델을 하나로 묵어서 주문이라는 상위 개념을 표현 할 수 있다.
- 애그리거트에는 루트가 존재한다.
- 루트를 통하여 관련된 하위 도메인 모델에 접근 할 수 있다.

#### 리포지터리
- 도메인 객체를 지속적으로 사용하려면 RDBMS, NoSQL, 로컬 파일과 같은 물리적인 저장소에 도메인 객체를 보관해야한다. 이를 위한 도메인 모델이 리파지토리이다.
- 엔티티나 밸류가 요구사항에서 도출되는 도메인 모델이라면 리포지터리는 구현을 위한 도메인 모델이다.
- 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.
- 응용 서비스와 리포지터리는 밀접한 연관이 있다.
    - 응용 서비스는 필요한 도메인 객체를 구하거나 저장할 때 리포지터리를 사용한다.
    - 응용 서비스는 트랜잭션을 관리하는데, 트랜잭션 처리는 리포지터리 구현 기술에 영향을 받는다.
- 리포지터리는 응용 서비스가 필요로 하는 메서드를 제공한다
    - 애그리거트를 저장하는 메서드
    - 애그리거트 루트 식별자로 애그리거트를 조회하는 메서드

#### 요청 처리 흐름
- 표현 영역 : 사용자가 애플리케이션에 기능 실행을 요청하면 그 요청을 처음 받는 영역
    - 스프링 프레임워크의 컨트롤러
    - 사용자가 전송한 데이터 형식이 올바른지 검사하고 문제가 없다면 데이터를 이용해서 응용 서비스에 기능을 실행을 위임
    - 사용자가 전송한 데이터를 응용 서비스가 요구하는 형식으로 변환해서 전달
- 응용 영역 : 도메인 모델을 이용해서 기능을 구현한다.
    - 기능 구현에 필요한 도메인 객체를 리포지터리에서 가져와 실행하거나 신규 도메인 객체를 생성해서 리포지터리에 저장된다.
    - 두 개 이상의 도메인 객체를 사용해서 구현하기도 한다.
    - 트랜잭션 관리도 여기에 포함 된다

#### 인프라스트럭처
- 표현 영역, 응용 영역, 도메인 영역을 지원한다.
- 도메인 객체의 영속성 처리, 트랜잭션, SMTP 클라이언트, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현 기술, 보조 기능을 지원한다.
- 도메인 영역과 응용 영역에서 인프라스트럭처의 기능을 직접 사용하는 것보다 두 영역에 정의한 인터페이스를 인프라스트럭처 영역에서 구현하는 것이 더 유연하고 테스트하기 쉽게 만든다.
- 하지만, 무조건 인프라스트럭처에 대한 의존을 없애는 것이 좋은 것은 아니다.
- ex) @Transacitonal, @Entity, @Table 같은 스프링 어노테이션 사용

#### 모듈 구성
- 모듈 구조를 얼마 세분화해야 하는지에 대해 정해진 규칙은 없다.
- 한 패키지에 너무 많은 타입이 몰려서 코드를 찾을 때 불편한 정도만 아니면 된다.
- 모듈을 분리하는 시도를 해보자.
