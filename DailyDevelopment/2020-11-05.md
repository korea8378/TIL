# 2020-11-05

## Kakao 실시간 댓글 개발기
- [실시간 댓글 개발기(part.3) – Spring의 동시성 접근 제어에 발목 잡힌 이야기](https://tech.kakao.com/2020/06/22/websocket-part3/)


## Thread Dump
- [스레드 덤프 분석하기](https://d2.naver.com/helloworld/10963)

## 정리
- Spring에서는 websocket의 기능을 보안해주고 메시징 전송을 더 효율적으로 보낼수 있도록 STOMP 프로토콜을 이용할 수 있다.
- STOMP에서는 구독(topic/subscribe)과 발행(app/publish)이 중요하다고 생각이 된다. 특정 topic을 구독하고 해당 topic에 대하서 다른 사용들이 메시지를 app/publish하면 topic을 구독한 모든 클라이언트에게 메시지를 전달할 수 있게 된다.
- 이방식은 메시지큐에서 많이 사용되기 때문에 제대로 공부할 필요가 있다고 생각이된다.
- 나같은 경우는 해당글의 구현에서 synchronized부분 때문에 성능 저하가 크다고 생각하였다. 하지만 모니터링을 통하여 정확하게 어디서 lock이 걸리는지 파악할 수 있었고 해당글에서 확인할 수 있었다.
- 모니터링을 통하여 좀 더 세밀한 분석이 확실히 성능개선에 큰 영향을 있는것 같다.
- Java를 모니터링 하기위해서는 Thread Dump가 필요하다. Dump를 생성도 쉽고 다양한 모니터링툴이 존재한다.
- Java는 멀티쓰레드를 사용한다. 또한 데몬 쓰레드와 비데몬 쓰레드를 통하여 GC, main등을 처리하고 있다.
- 또한 쓰레드의 상태에 대해서도 인지하고 있어야한다. NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING
- 멀티 쓰레드 환경이기 때문에 공유자원을 얻기 위해 경합을 하게 된다. 또한 공유자원(객체)에 대한 접근을 모니터를 통하여 동기화 시킨다. 쓰레들은 모니터를 가지기 위해 경합을 하게되고 얻기까지 락이 걸린다.
- 해당글에서 어렵지 않게 각각의 키워들을 쉽게 설명해주고 있다. 어려운 주제라고 생각되었지만 앞으로는 내가 개발한 어플리케션의 dump를 이용하여 모니터링을 꼭 해봐야겠다.


