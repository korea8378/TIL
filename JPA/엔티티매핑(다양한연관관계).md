# JPA

## 11월 20일

### 엔티티 매핑(다양한 연관 관계)

#### 엔티티의 연관관계 매핑시 고려사항
* 다중성
* 단방향, 양방향
* 연관관계의 주인

#### 다중성
* 다대일(@ManyToOne)
* 일대다(@OneToMany)
* 일대일(@OneToOne)
* 다대다(@ManyToMany)

#### 단방향, 양방향
* 테이블에서는 외래키 하나로 조인을 사용해서 양방향 조회가 가능하다.(객체에서는 불가능)
* 객체 관계에서 한 쪽만 참조하는 것을 단방향 관계, 양쪽이 서로 참조하는 것을 양방향 관계

#### 연관관계의 주인
* 데이터베이스에서는 외래키 하나로 양방향으로 관계를 맺음.
* 엔티티(객체)에서는 A->B, B->A 2곳에서 서로 참조한다.
* 두개의 객체중에서 데이터베이스 외래키를 관리하는데 이것은 연관관계의 주인이라고 한다.
* 주인이 아닌 방향의 객체에서는 외래키를 변경 불가능하고 읽기만 가능하다.

#### 양방향은 외래 키가 있는 쪽이 연관관계의 주인이다.
#### 양방향 연관관계는 항상 서로를 참조해야 한다.

#### 일대다, 다대일
* 일대다 & 다대일의 관계에서는 다쪽에서 대부분 외래키를 가지고 있다.
* 외래키를 가지고 있는곳이 연관관계의 주인이 되어야한다.
* 일에서 가지고 있으면 JPA에서 쿼리를 날리때 update쿼리를 추가로 날리기 때문에 복잡해지고 쿼리문이 더많이 실행된다.
* 다대일, 일대다이고 양방향일경우 서로의 관계를 참조할수있는 편의성 메소드를 양쪽 객체에 다만들어주자(객체 양방향관계는 두객체를 서로 참조시켜서 만들어야한다.)

#### 일대일
* 주 테이블에 외래키, 대상 테이블에 외래키 선택 가능하다.
* 주 테이블에 외래키 : 주 테이블이 외래 키를 가지고 있으므로 주 테일만 확인해도 대상 테이블관 연관관계가 있는지 확인 가능하다.
* 대상 테이블에 외래키 : 테이블 관계를 일대일에서 일대다로 변경 할 때 테이블 구조를 그대로 유지 할 수 있다.
* 주 테이블에 외래키에서는 단방향 양방향이 가능하지만 대상 테이블에 외래키에서는 양방향만 가능(JPA에서 단방향을 허용하지 않는다.)

#### 다대다
* 다대다에서는 두개의 테이블로는 구현할수 없다.
* 가운데에 조인테이블을 하나만든다.
* 식별관계 : 받아온 식별자를 기본 키 + 외래키로 사용한다. (추가적으로 구현 할게 많다)
* 비식별 관계 : 받아온 식별자는 외래 키로만 사용하고 새로운 식별자를 추가한다.