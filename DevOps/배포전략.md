# DevOps

## 08월 29일

### 배포 전략

#### Rolling
- Rolling 배포는 서버를 한 대씩 구 번전에서 새 번전으로 교체해가는 전략. 서비스 중인 서버 한대의 트래픽을 감소 시킨다. 트래픽이 사라지고 그 서버를 제외 시키고 새로운 버전의 서버로 대체 후 트래픽을 점진적으로 전환한다. 이와 같은 방식은 서버 수의 제약이 있을 경우 유용하나 배포 중 인스턴스의 수가 감소 되므로 서버 처리 용량을 미리 고려해야 한다.
- 애플리케이션의 새 버전을 한 번에 하나의 배치로 배포
- 기존 버전을 실행하는 인스턴스는 점차 제거
- 트래픽은 구 버전에서 새 버전으로 점진적으로 옮겨가게 됨

#### Blue/Green
- Blue/Green 배포는 구 버전에서 새 버전으로 일제히 전환하는 전략이다. 구 버전의 서버와 새 버전의 서버들을 동시에 나란히 구성하고 배포 시점이 되면 트래픽을 일제히 전환시킨다. 하나의 버전만 프로덕션 되므로 버전 관리 문제를 방지할 수 있고, 또한 빠른 롤백이 가능하다. 또 다른 장점으로 운영환경에서 영향을 주지 않고 실제 서비스 환경으로 새 버전 테스트가 가능하다. 예를 들어 구 버전과 새 버전을 모두 구성하고 포트를 다르게 주거나 내부 트래픽일 경우 새 버전으로 접근하도록 설정하여 테스트를 진행해 볼 수 있다. 단, 시스템 자원이 두 배로 필요하고, 전체 플랫폼에 대한 테스트가 진행 되어야 한다.
- 구버전과 새버전을 동시에 나란히 구성
- 하나의 버전만 프로덕션 트래픽을 처리
- 빠른 롤백 가능
- 운영환경에 영향을 주지 않고 새 버전 테스트 가능

#### Canary
- 구 버전의 서버와 새 버전의 서버들을 구성하고 일부 트래픽을 새 버전으로 분산하여 오류 여부를 판단한다. 이 기법으로 A/B 테스트도 가능한데, 오류율 및 성능 모니터링에 유용하다. 트래픽을 분산시킬 라우팅은 랜덤으로 할 수도 있고 사용자 프로필 등을 기반으로 분류할 수도 있다. 분산후 결과에 따라 새 버전이 운영 환경을 대체할 수도 있고, 다시 구 버전으로 돌아가 수도 있다.
- 새 버전의 애플리케이션으로 프로덕션 트래픽의 일부를 분산
- A/B 테스팅 사용 가능
- 라우팅은 임의적이거나 사용자 프로필을 기반으로 할 수 있음
- 결과에 따라 Canary 버전이 운영 환경을 대체하거나 혹은 중지할 수 있음

#### Switch
- 내부적인 컨트롤단/게이트웨이 로직으로 분기를 타게 만든다.(카카오페이 컨퍼런스)

#### References
https://onlywis.tistory.com/10