# 프로젝트 성패를 결정짓는 데이터 모델링 이야기

## 3월 6일

### 12.데이터 집합의 분리, 확장, 통합은 공학을 넘어 예술에 가깝다.

#### 배타 관계
- 하나의 엔터티가 두 개 이상의 상위(부모) 엔터티와 관계를 가지며, 그 관계가 상호 배타적일 때를 말한다.
- 배타 관계는 모델의 구조를 복잡하게 만들고, 복잡한 조인이 발생하게 하는 등 일반적으로 바람직하지 않다.
- 통상적으로 배타 관계 데이터 모델은 개발 시 배타 관계의 조인 문제 때문에 매우 나쁜 결과를 초래할 가능성이 높으니 주의해서 사용해야 한다.
- 될수 있으면 사용하지 않는 것이 좋다.

#### 데이터 모델링
- 단순하고 명확한 관계를 가지도록 하는 것이 바람직하다.
- 이를 위해서는 유사한 엔터티를 가능한 한 통합하는 것이 유리하다.
- 데이터의 성격이 유사한 엔터티가 분할되어 있으면 특정 트랜잭션 처리는 약간 단순해질지 모르지만, 매우 많은 엔터티를 복잡하게 연결해야 하는 경우가 훨씬 많다.

#### 동질의 엔터티를 통합함으로써의 얻을 수 있는 장점
- 데이터 모델의 구조가 단순하고 명확해진다.
- SQL이 단순해지고 코딩량이 줄어 개발 생산성이 좋아진다.
- 조인이 최소화되어 성능 이슈도 없어진다.
- 통합되지 않은 모델과 비교해서 요건 변경이에 따른 유연성이 극대화된다.

#### 엔터티 통합과 테이블 통합
- 서브타입에 대해 고민하다 보면 통합의 결과로서 서브타입을 포함한 큰 집합이 만들어지는 것인지, 아니면 집합을 분할할기 위해 서브타입을  기준으로 분리해야 하는 건지 모호할 때가 있다.
- 집합의 통합과 분리
    - 논리 모델과 물리 모델의 경계, 그리고 엔터티 통합과 테이블 통합을 구체적인 기준을 가지고 구분해야 한다.

#### 논리 모델
- 테이블, 파티셔닝 수준의 물리 모델링 단계에서 반드시 관통해야 하는 것이 논리 모델의 수정이다.
- 논리 모델은 업무에서 어떤 데이터가 어떻게 발생하고 존재하는지 인간이 이해하기 좋은 수준으로 분류하거나 묶은 형태다.
- 다시 말해 현실 업무의 모습을 정형화하여 박스와 관계선으로 표현하며, 설계자와 사용자 등의 이해관계자가 쉽게 이해할 수 있도록 하는 데 그 목적이 있다.
- 따라서 논리 모델을 끝까지 그대로 유지하려고 해서는 안 된다.
- 논리 모델은 DBMS나 이를 운용하는 하드웨어를 위한 것이 아니기 때문이다.
- 정규화 이론에 기반하여 데이터 무결성을 극한까지 보장해준다.

#### 물리 모델
- 물리 모델은 말 그대로 물리적 요소인 하드웨어가 최고의 성능을 발휘하도록 만들어야 한다.
- 무결성과 정합성을 깨는 것을 최소화하면서 성능 위주로 최적화하는 데 목표가 있다.
- 1:1 관계의 엔터티들은 물리 단계에서 통상 통합된다. 테이블의 볼륨이 작은 편이라면 통합하는 쪽이 더 효율적일 수 있다.

#### 데이터 모델
- 어는 수준까지 통합하거나 분리해야 하는지 명확하게 정의하기는 쉽지 않다.
- 엔터티의 통합과 테이블의 통합을 구분해야 한다.
- 논리 모델에서 통합할 것인지 분리할 것인지 애매한 집합은 일단 통합하고 시작한다.
- 그리고 상세화하는 과정에서 분리하는 쪽이 효율적이라 판다뇌면 물리 모델로 넘어가기 전이라도 분리를 하고, 그렇지 않다면 통합된 상태로 두면 된다.

#### 통합과 분할
- 통합과 분할의 일차적 기준은 데이터의 성격이어야 한다.
- 데이터가 비즈니스적으로 말하고자 하는 주제, 데이터의 정체성, 본질을 기준으로 하되 상위 엔터티들, 즉 업무 행위의 주체와 대상, 그리고 업무 행위의 최상위 놓이는 Account 등이 1차 타깃이다.
- 단, 통합된 것들의 독립성을 유지하기 위해 서브타입을 명확히 표현해야 한다.

#### 데이터 모델의 최상위 엔터티들을 통합하는 이유는 무엇일까?
- 모델 구조가 복잡해지고, 그에 따른 SQL 구현 난이도와 성능 이슈 등 위험요소가 많아지며, 업무 변화에도 유연하게 대응하기 어렵게 되기 때문이다.
- 무엇보다 상위 계층의 복잡도로 말미암아 하위 엔터티는 더더욱 복잡하고 성격 또한 불명확하게 된다.

#### 논리 모델의 분리와 관련해서 주의할 점
- 집합을 분리하게 되리라 판단되면 일찌감치 분리해버리는 편이 바람직하다.
- 상위 모델의 골격이 바뀌면 하위 엔터티와 관계 등 전반적인 형태가 틀어지는 등 영향도가 크기 때문이다.
- 통상적으로 상위 엔터티는 통합되는 것이 이익이 많으니 분리할 때는 충분한 검토가 필요하다.

#### 집합 형태의 최종 결정, 공학과 미학 사이
- 모델링이 가장 인간적인, 다시 말해 오직 사람만이 분석하고 판단해서 결정할 수 있는 통찰의 영역임을 증명하는 대표적인 영역이 바로 통합과 분리이다.
- 데이터 지합을 크게 묶어서 통으로 가져갈지, 아니면 필요에 따라 구체적인 여러 개로 나눌지 결정하는 일은 어렵다.
- 다만 집합을 어떤 형태로 분리하든 그 덩어리 집합의 정체성이 명확하기만 하다면 충분히 엔터티로 볼 수 있다.
- 문제는 그렇게 정의한 단위 집합이 얼마나 합리적이냐 하는 것이다.
- 모델링에서 이 단계가 가장 어려운 이유는 합리성이 인간의 종합적인 분석력, 사고력, 통찰력 등에 기반하기 때문이며, 이러한 분석과 통찰에는 업무 규칙, 데이터의 사용 패턴, 성능 등을 포함한 여러 환경적 요소가 복합적으로 영향을 미치기 때문이다.
- 집합은 구체적인 부분 집합으로 분리할 수 있고, 집합의 성격을 확장해서 다른 집합과 통합할 수도 있다.
- 때에 따라서는 일부를 중복시킬 수도 있다.
- 물론 중복은 일반적을 바람직하지 않으니, 특수한 목적 때문에 중복하는 것임을 명확히 인지한 경우에만 사용된다.
- 결구 통합하면 유연성이 좋아지고 구조가 단순해진다. 데이터 모델에서 유연성은 비즈니스가 변화해도 구조 변화가 최소화된다는 뜻이다.
- 다시 말해 기존 엔터티에 속성이 추가되거나 새로운 엔터티가 생성된다든가, 기존 관계에 변화가 생기는 일이 줄어듦을 의미한다.
- 집합의 통합과 확장은 반드시 본질이 유사한 것들을 대상으로 해야 한다는 것이다.
- 최상위 부모 엔터티들은 상대적으로 너그럽게 통합되어도 괜찮다.
- 만약 하위에서 배타적 관계가 많이 나타난다면 분리한 것에 문제가 있어 상위 개체가 통합되어야 한다는 신호로 보아야 한다.
- 통합은 반드시 데이터의 성겨과 정체성에 기반해야 한다.

#### 교집합을 처리하는 기준
- 1.중첩된 개체를 한쪽 집합에만 존재하도록 그 소유를 분명하게 정의하는 것
- 2.집합이 중복되도록, 즉 개체가 여러 집합에 공존하게 하는 것



