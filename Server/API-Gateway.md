# Server

## 11월 22일

### API GATEWAY

* API Gateway는 API서버 앞단에서 모든 API 서버들의 엔드포인트를 단일화하여 묶어주고 API에 대한 인증과 인가 기능에서 부터 메세지에 따라서 여러 서버로 라우팅 하는 고급기능 까지 많은 기능을 담당 할 수 있다.

#### API Gateway의 주요 기능
* 인증/인가에 관련된 기능
* 인증 : 클라이언트에 대한 Identity(신분)을 확인 해주는 기능
* 인가 : 클라이언트가 API를 호출 할 수 있는 권한이 있는지 확인 해주는 기능
* 예 : 페이스북 계정을 가지고 있는 사용자가 맞는지, API 호출시 어느권한 (일반사용자, 관리자 권한)까지 호출 할 수 있는지 판단하여 API 호출을 허가하는 기능

#### API 토큰 발급
* 토큰을 통한 인가/인증
* 사용자(ID/Password) -> API Gateway -> 인증서버(인증) ->  API Gateway -> 토큰발급 -> 사용자
* 클레임기반토큰 : 서버에 토큰정보를 저장하지않고 사용(JWT/유효기간지정 필수)
* 서버기반의토큰 : 서버에 저장하여 사용(캐싱처리)

#### 엔드포인트별 API 호출 인증
* API를 호출 하는사람이 맞는 확인 해주는 것
* 클레임기반토큰 : 토큰을 까서 그안에 있는 내용을 가지고 API 호출 가능 여부 결정
* 서버기반의토큰 : 서버에 저장되어있는 토큰과 요청 API토큰을 비교하여 인증 뒤 API 호출
 
#### 엔드포인트별 API 요청 인가
* API를 호출 하는사람이 그 API를 호출 할 수 있는 권한을 확인 해주는 것

#### API 라우팅
* 백엔드 API 서버로의 로드 밸런싱

#### 서비스 및 클라이언트 별 엔드포인트 제공
* 같은 API를 여러개의 엔드 포인트를 통해서 서비스를 제공 할 수 있다.
* API 서버가 공통적인 API를 가지더라도, 각 서비스나 클라이언트 타입에 따라서 각각 다른 API를 선별적으로 서비스 할 수 있도록 해준다.

#### 공통의 로직 처리
* API 게이트웨이는 특성상 모든 API 서버 앞쪽에 위치 하기 때문에, 모든 API 호출이 이 API 게이트를 거쳐간다. 그렇기 때문에, 모든 API가 공통적으로 처리해야 하는 공통 기능이 필요할 경우 이러한 공통 기능을 API 게이트웨이로 옮기게 되면 별도로 API 서버에서 이러한 기능을 개발할 필요 없이 비지니스 로직 자체 구현에만 집중 할 수 있게 된다.(로깅, 인증 등)

#### 메디에시션 기능
* 메세지 포맷 변환
* 프로토콜 변환 : 클라이언트에서 각각 다른 프로토콜로 요청을 하더라도 API서버로 가기전에 동일한 프로토콜로 변환해서 보낸다.
* 메세지 호출 패턴 변환 : 게이트웨이에 메세지 큐를 사용해 메세지 호출 패턴 구현가능
* 어그레게이션 : 서비스서버를 조합해서 새로운 서비스를 만든다. API Gateway에서는 처리하지않고 따로 하나의 서버의 두고 거기서 서비스 서버간의 새로운 서비스 로직을 처리하게 하자.

#### 로깅 및 미터링
* API 로깅 호출 : 게이트웨이를 통해서 API가 호출 되기때문에 로깅을 쌓는다.
* 미터링
* QOS

#### API GATEWAY 구현 방법
* 다중 API 게이트웨이 아키텍쳐
* 파일업.다운로드 엔드포인트 분리
* 특수 목적 엔드포인트 분리
* 트랜잭션 ID 추적 패턴

