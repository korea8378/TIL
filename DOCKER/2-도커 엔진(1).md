# 2021-07-14

# 2장 도컨 엔진

## 도커 엔진
- 도커 엔진에서 사용되는 기본 단위는 이미지와 컨테이너

## 도커 이미지
- 이미지는 컨테이너를 생성할 때 필요한 요소이며, 가상 머신을 생성할 때 사용하는 iso 파일과 비슷한 개념이다.
- 이미지는 여러 개의 계층으로 된 바이너리 파일로 존재하고, 컨테이너를 새어하고 실행할 때 읽기 전용으로 사용됩니다.

## 도커 컨테이너
- 컨터이너는 이미지를 읽기 전용으로 사용하되 이미지에서 변경된 사망한 컨테이너 계층에 저장하므로 컨테이너에서 무엇을 하든지 원래 이미지는 영향을 받지 않습니다.
- 생성된 각 컨테이너는 각기 독립된 파일시스템을 제공받으며 호스트와 분리돼 있으므로 특정 컨테이너에서 어떤 애플리케이션을 설치하거나 삭제해도 다른 컨테이너와 호스트는 변화가 없습니다.

## 도커 다루기
- 컨테이너 생성 
    - docker run
    - -i : 상호 입출력
    - -t : tty를 활성화해서 배시 셜을 사용하도록 컨테이너 설정
    - 컨테이너 빠져 나오기
        - exit : 컨테이너를 빠져나오면서 컨테이너 상태를 종료로 변경
        - Ctrl + p, q : 컨테이너 상태를 변경하지않고 컨테이너 빠져 나오기
    - -name : 이름 지정
    - run 명령어
        - pull -> create -> start -> attach
    - create 명령어
        - pull -> create
    - -d : 백그라운드 모드
    - -e : 컨테이너 내부에 환경변수 전달
    - - -link : 다른 컨테이너의 이름을 통하여 컨테이너에 접근(ip주소 대응)
- 도커 상태
    - docker ps
    - -a : 종료된 컨테이너 포함
- 컨테이너 삭제
    - docker rm
    - -f : 실행중 컨테이너 삭제
    - docker  prune
        - 모든 컨테이너 삭제
- 포트 포워딩
    - docker run -p
    - 호스트 포트 : 컨테이너 포트
- 도커 볼륨
    - 호스트에 데이터를 저장 및 공유하기 위해서
    - 도커는 기본적으로 statefull -> stateless
    - docker run -v
        - 호스트 디렉토리 : 컨테이너 디렉토리
        - 호스트 디렉토리 직접 지정
    - docker run -- volumes-from
        - 볼륨이 지정된 컨테이너를 지정함으로써 다른컨테이너도 같은 볼륨을 사용
    - docker volume
        - 도커엔진이 관리하는 볼륨(호스트에 저장)을 만들어 컨테이너에 지정
- 도커 네트워크
    - 컨테이너 생성 순서대로 가상의 eth 생성
    - docker 브리지
    - 도커 자체에서 제공하는 브리지, 호스트, 논, 컨테이너, 오버레이
    - 서드파티
    - -- net : 브리지
    - -- net  host : 호스트
    - -- net noon : 논
    - -- net container : 컨테이너
    - -- net-alias : 별명을 이용하여 여러 컨테이너에서 동시에 사용(라운드로빈으로 접근)
- MacVLAN
    - 호스트의 네트워크 인터페이스 카드를 가상화해 물리 네트워크 환경을 컨테이너에게 동일하게 제공합니다.
- 컨테이너 로깅
    - docker logs : json-file log(기본적인)
    - -- log-driver : json-file 말고 다른 로그 드라이브 사용가능
        - syslog : 유닉스 계열의 오래된 표준 로그 드라이브
        - fluentd : 다양한 데이터베이스와 연동을 할 수 있는 드라이브
        - 아마존 클라우드 워치 로그 : aws에서 제공하는 로그 서비스
    - -- log-opt : 해당 옵션으로 로그 크기, 원격 주소, 태크등 다양하게 지정가능
- 컨테이너 자원 할당
    - 호스트 자원을 제한할수 잇는 기능
    - 기본적으로 아무런 입력이 없다면 호스트의 자원에대한 제한이 없다.
    - -- memory : 메모리 제한
    - -- memory-swap : 스와이프 메모리 제한(기본적으로 메모리의 2배로 설정됨)
    - -- cpu-shares : 호스트 cpu의 사용 가중치를 설정
    - -- cpuset-cpu : 호스트의 여러개 cpu중 하나를 선택
    - -- cpu-period, -- cpu-quota : 호스트 cpu의 스케줄링 가중치
    - -- cpus : cpu를 사용할 수 있는 갯수
    - -- device-write-bps : Block I/O 제한
    - 스토리지 제한은 사용할수 있는 경우도 있지만 도커의 stateless에 반대되는 성향 즉 statefull이 되기 때문에 지양해야한다.


## 도커의 철학
- 한 컨테이너에 프로세스 하나만 실행하는 것이 도커의 철학
