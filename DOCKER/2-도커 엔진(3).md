# 2021-07-19

# 2장 도커 엔진(3)

## 도커 데몬
- 도커 클라이언트
        - 도커 데몬은 API 입력을 받아 도커 엔진의 기능을 수행하는데, 이 API를 사용할 수 있도록 CLI를 제공하는 것
- 도커 서버(도커 데몬)
    - 실제로 컨테이너를 생성하고 실행하며 이미지를 관리하는 주체
- ex)
    - 1.사용자가 docker ps 같은 도커 명령어를 입력합니다.
    - 2./usr/bin/docker는 /var/run/docker.sock 유닉스 소켓을 사용해 도커 데몬에게 명령어를 전달합니다.
    - 3.도커 데모은 이 명령어를 파싱하고 명령에 해당하는 작업을 수행합니다.
    - 4.수행 결과를 도커 클라이언트에게 반환하고 사용자에게 결과를 출력합니다.
- dockerd로 도커 데몬을 실행합니다.
- -- help
    - 출력 결과 상세히
- -- insecure-registry
    - 레지스트리 컨테이너 구축
- -- log-driver
    - 컨테이너 로깅
- -- storage-opt
    - 스토리지 백엔드를 변경
- -H
    - 도커 데몬의 API를 사용할 수 있는 방법을 추가
    - 1.로컬에서 클라이언트가 CLI를 통해 연동
    - 2.RESTFul API를 통해 다른 원격 클라이언트가 연동
- - - tlsverify
    - 도커 데몬에 보안적용
    - HTTPS

## 스토리지 드라이브
- CoW
    - Copy on Write
    - 읽는 작업 한번, 파일을 스냅숏 공간에 쓰고 변경된 사항을 쓰는 2번의 쓰기 작업
- RoW
    - Redirect on Write
    - 스냅숏에 기록된 원본 파일은 스냅숏 파일로 묶은 뒤 변경된 사항을 새로운 장소에 할당 받아 덮어쓰는 형식(1번의 쓰기 작업) <- 도커 이미지 방식
- 스냅숏
    - 원본 파일은 읽기 전용으로 사용하되 이 파일이 변경되면 새로운 공간을 할당한다.

## 여러가지 스토리지 드라이브


## 도커 데몬 모니터링
- -D
    - 도커 데몬 디버그 모드
- events
    - 도커 데몬에 어떤 일이 일어나고 있는지를 실시간 스트림으로 보여줍니다.
- stats
    - 실핼중인 모든 컨테이너의 CPU, 메모리 제한 및 사용량, 네트워크 입출력, 블록 입출력 정보를 출렵합니다.
- system df
    - 도커에서 사용하고 있는 이미지, 컨테이너 로컬 볼륨의 총 개수 및 사용 중인 개수, 크기, 삭제함으로써 확보 가능한 공간을 출력합니다.
- CAdvisor
    - 구글이 만든 컨테이너 모니터링 도구로, 컨테이너로서 간단히 설치할 수 있고 실시간 자원 사용량 및 도커 모니터링 정보등을 시각화해서 보여줍니다.
    - 단일 도커 호스트만을 모니터링 할 수 있다는 한계가 있습니다.
- 쿠버네티스나 스웜 모드 등과 같은 오케스트레이션 툴을 설치한 뒤에 프로메테우스, InfluxDB등을 이용해 여러 호스트의 데이터를 수집하는 것이 일반적입니다.
