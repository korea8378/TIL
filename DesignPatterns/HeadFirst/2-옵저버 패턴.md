# Head First Design Patterns

## 07월 18일

### 2.옵저버 패턴

#### 개요
- 뭔가 중요한 일이 일어났을 때 객체들한테 새소식을 알려줄 수 있는 패턴이 있다.
- 객체 쪽에서 계속해서 정보를 받을지 여부를 실행중에 결정할 수 있다.
- 옵저버 패턴은 JDK에서 가장 많이 쓰이는 패턴 가운데 하나이다.
- 일대다 관계와 느슨한 결합에 대해서도 공부해보자.

#### 기상 모니터링 애플리케이션
- WeatherData 객체에서 최신 측정치를 수집할 수 있다.
- 최신 측정치를 갱신하여 이데이터를 쓰는 디스플레이 장비들에게 최신의 데이터를 전달할 수 있도록 하자.
- 어떻게 하면 최신의 데이터를 디스플레이에게 전달 할 수 있을까?
    - 신문이나 잡지를 어떤 식으로 구독하는지 생각해보자(옵저버 패턴)

#### 신문이나 잡지를 어떤식으로 구독할까?
- 신문사가 사업을 시작하고 신문을 찍어내기 시작한다.
- 독자가 특정 신문사/잡지사에 구독 신청을 하면 매번 새로운 신문/잡지가 나올 때매다 배달을 받을 수 있다. 계속 구독자로 남아있는 이상 계속해서 신문/잡지를 받을 수 있다.
- 신문을 더 이상 보고 싶지 않으면 구독 해지 신청을 합니다. 그러면 더 이상 신문이 오지 않는다.
- 신문사가 계속 영업을 하는 이상 여러 개인 독자, 호텔, 항공사 및 기타 회사등에서 꾸준히 구독 및 해지를 하게 됩니다.
- 출판사를 주제(Subject), 구독자를 옵저버(Objserver)라고 부르자.

#### 옵저버 패턴
- 한 객체의 상태가 바뀌면 객체에 의존하는 다른 객체들한테 연락이 가고 자동으로 내용이 갱신되는 방식으로 일대다 의존성을 정의한다.
- 옵저버 패턴을 구현하는 방법에는 여러 가지가 있지만, 대부분 주제 인터페이스와 옵저버 인터페이스가 들어있는 클래스 디자인을 바탕으로 한다.

#### 느슨한 결합의 위력
- 주제가 옵저버에 대해서 아는 것을 옵저버가 특정 인터페이스를 구현한다는 것 뿐이다.
- 옵저버는 언제든지 새로 추가할 수 있다.
- 새로운 형식의 옵저버를 추가하려고 할 때도 주제를 전혀 변경할 필요가 없다.
- 주제와 옵저버는 서로 독립적으로 재사용할 수 있다.
- 주제나 옵저버가 바뀌더라도 서로한테 영향을 미치지는 않다.

#### 디자인 원칙 - 서로 상호작용을 하는 객체 사이에서는 가능하면 느슨하게 결합하는 디자인을 사용해야 한다.
- 인터페이스를 이용하여 느슨하게 결합하자.
- 느슨하게 결합하는 디자인을 사용하면 변경 사항이 생겨도 무난히 처리할 수 있는 유연한 객체지향 시스템을 구축할 수 있다.
- 객체 사이의 상호의존성을 최소할 수 있다.
- 두 객체가 느슨하게 결합되어 있다는 것은, 그 둘이 상호작용을 하긴 하지만 서로에 대해 잘 모른다는 것을 의미한다.

#### 자바의 옵저버 패턴
- 자바에서도 자체적으로 옵저버 패턴을 일부 지원한다.
- 하지만 직접 구현하는 편을 선호한다. (구현하는데 많은 시간을 투자하지 않아도 된다.)
- 자바의 옵저버패턴은 주체가 인터페이스가 아닌 구현체이다. 그렇기 때문에 확장의 개념으로 추가적으로 다른 클래스를 상속 받을 수 없다.(인터페이스가 아닌 구현으로 인한 재사용성이 감소한다.)
- setChanged()메서드가 protected로 선언되어 있어 Observable의 서브클래스에서만 setChanged() 메서드를 호출 할 수 있다.

#### 옵저패턴 push, pull, setChange()
- push
    - 주체가 옵저버들에게 같은 데이터를 전달하는 방식
- pull
    - 옵저버가 필요한 데이터만 들고오는 방식
- setChange()
    - 데이터 변동시 반드시 옵저버들에게 데이터를 전달하기 보다는 일정한 조건을 만족하면 데이터를 전달하기 위해 정의하는 플래그 설정 메서드

#### 옵저버 패턴의 디자인 원칙 - 애플리케이션에서 바뀌는 부분을 찾아내서 바뀌지 않는 부분으로부터 분리하자.
- 옵저버 패턴에서 변하는 것은 주제의 상태와 옵저버의 개수, 형식이다.
- 옵저버 패턴에서는 주제를 바꾸지 않고도 주제의 상태에 의존하는 객체들을 바꿀 수 있다.
- 나중에 바뀔 것에 대비해 두면 이렇게 변하게 작업할 수 있다.

#### 옵저버 패턴의 디자인 원칙 - 구현이 아닌 인터페이스에 맞춰서 프로그래밍한다.
- subject와 observer에서 모두 인터페이스를 사용했다.
- subject에서는 subject 인터페이스를 통해서 observer 인터페이스를 구현하는 객체들의 등록/탈퇴를 관리하고 그런 객체들한테 연락을 돌린다.
- 지금까지 우리가 봐 왔던 것처럼, 이렇게 함으로써 결합을 느슨하게 만들 수 있다.

#### 옵저버 패턴의 디자인 원칙 - 상속보다는 구성을 활용한다.
- 옵저버 패턴에서는 구성을 활용하며, 옵저버들을 관리합니다.
- 주제와 옵저버 사이의 관계는 상속이 아니라 구성에 의해서 이루어진다.
- 게다가 실행중에 구성되는 방식을 사용하니까 더할 나위 없이 좋을것이다.
