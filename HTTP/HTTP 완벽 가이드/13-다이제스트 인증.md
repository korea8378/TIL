# HTTP 완벽 가이드

## 4월 30일

### 13장 다이제스트 인증

#### 개요
- 기본 인증은 편리하고 유연하지만 전혀 안전하지 않다.
- 사용자 이름과 비밀번호를 평문으로 보내고, 메시지를 위조하지 못하게 보호하려는 어떠한 시도도 하지 않는다.
- 유일한 방법은 SSL과 결합해서 사용하는 것이다.
- 다이제스트 인증은 기본 인증과 호환되는 더 안전한 대체재로서 개발되었다.

#### 다이제스트 인증의 개선점
- 다이제스트 인증은 기본 인증의 가장 심각한 결함을 수정한 또 다른 HTTP 인증 프로토콜이다.
- 다이제스트 인증의 특징
    - 비밀번호를 절대로 네트워크 통해 평문으로 전송하지 않는다.
    - 인증 체결을 가로채서 재현하려는 악의적인 사람들을 차단한다.
    - 구현하기에 따라서, 메시지 내용 위조를 막는 것도 가능하다.
    - 그 외 몇몇 잘 알려진 형태의 공격을 막는다.
- 다이제스트 인증이 가능한 가장 안전한 프로토콜은 아니다.
- 안전한 HTTP 트랜잭션을 위한 많은 요구사항을 만족하지 못한다. (전송 계층 보안과 보안 HTTPS가 더 적합한 프로토콜이다)

#### 비밀번호를 안전하게 지키기 위해 요약 사용하기
- 다이제스트 인증의 좌우명은 “절대로 비밀번호를 네트워크를 통해 보내지 않는다.”
- 클라이언트는 비밀번호를 비가역적으로 뒤섞은 ‘지문’ 혹은  ‘요약’을 보낸다.
- p.333 참고

#### 단방향 요약
- 요약은 정보 본문의 압축이다. 요약은 단방향 함수로 동작하고, 일반적을 입력 가능한 무한 가지의 모든 입력값들을 유한한 범위의 압축으로 변환한다.
- 인기 있는 요약 함수 중 하나인 MD5는 임의의 바이트 배열을 원래 길이와 상관없이 128비트 요약으로 변환한다.
- 요약 함수는 보통 암호 체크섬으로 불리며, 단방향 해시 함수이거나 지문 함수이다.

#### 재전송 방지를 위한 난스 사용
- 단방향 요약은 비밀번호를 그대로 전송해야 할 필요성에서 우리를 해방시켜 준다.
- 우리는 그 대신 그냥 비밀번호에 대한 요약을 보내주고, 악의적인 집단이 쉽게 요약에서 원래 비밀번호를 해독할 수 없음을 보장받기만 하면 된다.
- 요약을 가로채서 서버로 몇 번이고 재전송 할수 있기 때문에, 요약은 비밀번호 자체와 다름없다.(재전송 공격)
- 이런 재전송 공격을 방지하기 위해서 서버는 클라이언트에게 난스라고 불리는 특별한, 그리고 자주 바뀌는 증표를 건네준다.
- 난스를 비밀번호에 섞으면 난스가 바뀔 때마다 요약도 바뀌게 만들어준다.
- 다이제스트 인증은 난스를 사용할 것을 요구한다.

#### 다이제스트 인증 핸드셰이크
- HTTP 다이제스트 인증 프로토콜은 기본 인증에서 사용하는 것과 비슷한 헤더를 사용하는, 강화된 버전의 인증이다.
- 기존 헤더에 몇몇 새 옵션이 추가되었고, 선택적인 헤더인 Authorization-Info가 새로 추가되었다.

#### 요약 계산
- p338 ~ p341

#### 다이제스트 인증 세션
- 어떤 보호 공간을 위한 WWW-Authenticate 인증요구에 대한 클라이언트 응답은, 그 보호 공간에 대한 인증 세션을 시작하게 한다.

#### 사전 인가
- 일반적인 인증에서는, 각 요청은 트랜잭션이 완료되기 전에 요청/인증요구 사이클을 필요로 한다.
- 만약 클라이언트가 다음 난스가 무엇이 될지 미리 알고 있어서, 서버가 물어보기전에 올바른 Authorization 헤더를 생성할 수 있다면, 이 요청/인증요구 사이클은 생략할 수 있다.
- 다이제스트 인증에서의 사전 인가는 약간 더 복잡하다. 왜냐하면 난스 기술은 재전송 공격을 저지하기 위한 것이기 때문이다.
- 서버는 임의의 난스를 생성하기 때문에, 인증 요구를 받기 전에는 클라이언트가 무엇이 올바른 Authorization 헤더인지 알 방법이 없다.
- 인증요구를 기다리지 않고 올바른 난스를 취득할 수 있는 방법
    - 서버가 다음 난스를 Authentication-Info 성공 헤더에 담아서 미리 보낸다.
    - 서버가 짧은 시간 동안 같은 난스를 재상용하는 것을 허용한다.
    - 클라이언트와 서버가 동기화되어 있고 예측 가능한 난스 생성 알고리즘을 사용한다.

